<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://wzrd.in/standalone/buffer"></script>
    <script src="https://unpkg.com/ipfs-api@9.0.0/dist/index.js"
    integrity="sha384-5bXRcW9kyxxnSMbOoHzraqa7Z0PQWIao+cgeg327zit1hz5LZCEbIMx/LWKPReuB"
    crossorigin="anonymous"></script>
    <script src="vendor/qr_packed.js">  </script>
    <link rel="stylesheet" href="main.css">
    <title>Let Me In</title>
  </head>
  <body>
    <header>
      <h1>Let Me In</h1>
    </header>

    <h2>Grant New Access</h2>
    <div>
      <label for="address">Address</label>
      <input type="text" id="address">
    </div>

    <div>
      <label for="address">Expiry</label>
      <input type="date" id="expiry">
    </div>

    <div>
      <label for="photo">Photo</label>
      <input type="file" id="photo">
    </div>

    <div id="container">
      <h1>QR Code Scanner</h1>

      <a id="btn-scan-qr">
          <img src="https://uploads.sitepoint.com/wp-content/uploads/2017/07/1499401426qr_icon.svg">
      <a/>

      <canvas hidden="" id="qr-canvas"></canvas>

      <div id="qr-result" hidden="">
          <b>Data:</b> <span id="outputData"></span>
      </div>
    </div>
    <div>
      <input type="submit" id="submit">
    </div>
    <script src="qrCodeScanner.js"></script>
    <script src="vendor/@truffle/contract/dist/truffle-contract.min.js"></script>
    <script src="vendor/web3/dist/web3.min.js"></script>
    <script src="Utils.js"></script>
    <script src="IpfsModule.js"></script>
    <script src="app.js"></script>
    <script>
    (function () {
      const app = new App();
      const submit = document.getElementById("submit");
      if (submit) {
        submit.addEventListener("click", async () => {
          const address = document.getElementById("address").value;
          const expiry = Utils.date2timestamp(
            document.getElementById("expiry").value
          );

          // TODO: photo validation
          if (expiry && address) {
            IpfsModule.upload("photo", async (photoUrl) => {
              console.log("photoUrl: ", photoUrl);
              await app.createAccess(address, expiry, photoUrl);
            });
          } else {
            window.alert("invalid inputs");
          }
        });
      }
    })();
    </script>
  </body>
</html>
